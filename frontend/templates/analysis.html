{% extends "base.html" %}

{% block content %}
<div class="analysis-page">
    <h2>Daily Analysis</h2>

    <!-- Chart Container -->
    <div class="chart-container">
        <canvas id="activityChart" data-labels='{{ chart_labels | tojson }}' data-sleep='{{ chart_sleep | tojson }}'
            data-cry='{{ chart_cry | tojson }}'></canvas>
    </div>

    <div class="tabs">
        <button class="tab active" onclick="showTab('sleeps')">Sleeps</button>
        <button class="tab" onclick="showTab('cries')">Cries</button>
    </div>

    <div id="sleeps" class="list-section active">
        {% for sleep in sleeps %}
        <div class="list-item">
            <div class="item-icon sleep-icon"><i class="fa-solid fa-moon"></i></div>
            <div class="item-details">
                <span class="item-title">Sleep Session</span>
                <span class="item-info">
                    {{ sleep.start_time.strftime('%Y-%m-%d %H:%M') }}
                    {% if sleep.end_time %} - {{ sleep.end_time.strftime('%H:%M') }}{% else %} (Ongoing){% endif %}
                </span>
            </div>
        </div>
        {% endfor %}
    </div>

    <div id="cries" class="list-section" style="display: none;">
        {% for cry in cries %}
        <div class="list-item">
            <div class="item-icon cry-icon">
                <i class="fa-solid {% if 'Voice' in cry.intensity %}fa-microphone{% else %}fa-face-sad-tear{% endif %}"></i>
            </div>
            <div class="item-details">
                <span class="item-title">
                    {{ cry.intensity }}
                    {% if 'Auto' in cry.intensity %}<span class="verified-badge"
                        style="font-size: 0.6rem; background: #E0F2FE; color: #0369A1; padding: 2px 6px; border-radius: 4px; margin-left: 8px;"><i
                            class="fa-solid fa-robot"></i> AI Sync</span>{% endif %}
                </span>
                <span class="item-info">{{ cry.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
            </div>
            {% if cry.audio_url %}
            <div class="audio-player">
                <audio id="audio-{{cry.id}}" src="{{cry.audio_url}}"></audio>
                <button onclick="document.getElementById('audio-{{cry.id}}').play()"
                    style="background: var(--primary-light); color: var(--primary); border: none; width: 32px; height: 32px; border-radius: 50%; cursor: pointer;">
                    <i class="fa-solid fa-play"></i>
                </button>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<script>
    function showTab(tabName) {
        document.querySelectorAll('.list-section').forEach(el => el.style.display = 'none');
        document.getElementById(tabName).style.display = 'block';
        document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
        event.target.classList.add('active');
    }
</script>
{% endblock %}