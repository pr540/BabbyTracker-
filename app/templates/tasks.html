{% extends "base.html" %}

{% block content %}
<div class="dashboard">
    <!-- Online/Offline Sync Indicator -->
    <div id="syncStatus" class="sync-indicator">
        <i class="fa-solid fa-cloud-check"></i> <span>Connected</span>
    </div>

    <!-- Status Card and Baby Profile -->
    <div class="welcome-banner" style="display: flex; justify-content: space-between; align-items: flex-start;">
        <div>
            <h1>Hello, {{ baby.name }}! {% if baby.gender == 'Girl' %}ðŸŽ€{% else %}ðŸ§¸{% endif %}</h1>
            <p>Parenting made easy.</p>
        </div>
        {% if baby.photo_url %}
        <div class="baby-photo-large">
            <img src="{{ baby.photo_url }}" alt="{{ baby.name }}">
        </div>
        {% endif %}
    </div>

    <div class="status-card {% if ongoing_sleep %}sleeping{% else %}awake{% endif %}">
        <div class="status-icon">
            {% if ongoing_sleep %}
            <i class="fa-solid fa-moon"></i>
            {% else %}
            <i class="fa-solid fa-sun"></i>
            {% endif %}
        </div>
        <div class="status-text">
            <h2>{% if ongoing_sleep %}Sleeping{% else %}Awake{% endif %}</h2>
            <p>{% if ongoing_sleep %}Started at {{ ongoing_sleep.start_time.strftime('%H:%M') }}{% else %}Ready for
                nap?{% endif %}</p>
        </div>
    </div>

    <!-- Back Button & Title -->
    <div style="margin-bottom: 24px;">
        <a href="/"
            style="text-decoration: none; color: var(--text-muted); display: flex; align-items: center; gap: 8px; font-weight: 600;">
            <i class="fa-solid fa-arrow-left"></i> Back to Home
        </a>
    </div>

    <div id="activityScreen" class="main-screen active">
        <!-- Daily Routine / Baby tasks -->
        <div class="tasks-container">
            <div class="section-header">
                <h3>Baby Tasks</h3>
                <div class="progress-inline">
                    {% set completed = tasks|selectattr('is_completed')|list|length %}
                    {% set total = tasks|length %}
                    {% set percent = (completed / total * 100)|int if total > 0 else 0 %}
                    <span class="progress-text-mini">{{ completed }}/{{ total }}</span>
                    <div class="progress-bar-mini">
                        <div class="progress-fill-mini" data-progress="{{ percent }}"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Task Form (Inline - Matches Image) -->
        <form action="/task/create" method="post" class="add-task-form">
            <div class="task-input-wrap">
                <input type="text" name="title" placeholder="New Task (e.g. Diaper Change)" required>
            </div>
            <div class="time-input-wrap">
                <input type="time" name="due_time" value="12:00" required>
                <i class="fa-regular fa-clock"></i>
            </div>
            <button type="submit" class="save-btn">Save</button>
        </form>

        <div class="tasks-grid">
            {% for task in tasks %}
            <div class="task-row">
                <form action="/task/toggle/{{ task.id }}" method="post" class="task-form">
                    <button type="submit" class="task-card {% if task.is_completed %}completed{% endif %}">
                        <div class="task-status">
                            {% if task.is_completed %}
                            <i class="fa-solid fa-circle-check"></i>
                            {% else %}
                            <div class="category-icon">
                                {% if 'Feed' in task.title or task.category == 'Feeding' %}
                                <i class="fa-solid fa-bottle-baby"></i>
                                {% elif 'Diaper' in task.title or task.category == 'Diaper' %}
                                <i class="fa-solid fa-soap"></i>
                                {% elif 'Medicine' in task.title or task.category == 'Medicine' %}
                                <i class="fa-solid fa-pills"></i>
                                {% elif 'Bath' in task.title or task.category == 'Bath' %}
                                <i class="fa-solid fa-bath"></i>
                                {% else %}
                                <i class="fa-solid fa-star"></i>
                                {% endif %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="task-info">
                            <span class="task-title">{{ task.title }}</span>
                            <span class="task-time">{{ task.due_time or 'Today' }}</span>
                        </div>
                    </button>
                </form>
                {% if not task.is_completed %}
                <form action="/task/skip/{{ task.id }}" method="post">
                    <button type="submit" class="skip-btn">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </form>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}